<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sama - Test de Biotipo Ayurveda</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fuente (Opcional, para mejor estética) -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Montserrat', sans-serif; }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        .animate-float { animation: float 6s ease-in-out infinite; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
    </style>

    <!-- Import Map para Módulos de React -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.263.1?deps=react@18.2.0",
            "firebase/app": "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js",
            "firebase/auth": "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js",
            "firebase/firestore": "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"
        }
    }
    </script>
</head>
<body class="bg-[#fff6ea] text-gray-800">
    <div id="root"></div>

    <script type="module">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { initializeApp } from 'firebase/app';
        import { getAuth, signInAnonymously, onAuthStateChanged } from 'firebase/auth';
        import { getFirestore, collection, addDoc, serverTimestamp } from 'firebase/firestore';
        import { MoveRight, CheckCircle2, Leaf, Flame, Wind, Mail, ArrowRight, Loader2, Info } from 'lucide-react';

        // --- ⚠️ TU CONFIGURACIÓN DE FIREBASE AQUÍ ⚠️ ---
        // 1. Ve a console.firebase.google.com
        // 2. Crea un proyecto > Agrega una app web (</>)
        // 3. Copia el objeto 'firebaseConfig' y pégalo abajo reemplazando el existente.
        
        const firebaseConfig = {
            apiKey: "TU_API_KEY_AQUI",
            authDomain: "TU_PROYECTO.firebaseapp.com",
            projectId: "TU_PROYECTO",
            storageBucket: "TU_PROYECTO.firebasestorage.app",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdef"
        };

        // Inicialización segura de Firebase
        let app, auth, db;
        let isFirebaseReady = false;

        try {
            if (firebaseConfig.apiKey !== "TU_API_KEY_AQUI") {
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
                isFirebaseReady = true;
                console.log("Firebase conectado correctamente.");
            } else {
                console.warn("Firebase no está configurado. El test funcionará en modo DEMO (no guardará datos).");
            }
        } catch (error) {
            console.error("Error inicializando Firebase:", error);
        }

        // --- DATOS DEL TEST ---
        const questionsData = {
            vata: [
                "Realizo mis actividades muy deprisa", "No se me da bien memorizar cosas ni recordarlas más adelante",
                "Soy entusiasta y vivaz por naturaleza", "Tengo una figura delgada, no aumento de peso con facilidad",
                "Siempre he aprendido cosas nuevas con facilidad", "Mis andares característicos son ligeros y rápidos",
                "Me cuesta tomar decisiones", "Tiendo a tener gases y estreñimiento", "Suelo tener las manos y los pies fríos",
                "Me pongo ansioso o me preocupo frecuentemente", "No tolero el frío tanto como la mayoría",
                "Hablo muy deprisa, y mis amigos me consideran una persona parlanchina", "Cambio de humor con facilidad y tengo una naturaleza emotiva",
                "Me cuesta conciliar el sueño o dormir de un tirón toda la noche", "Tengo la piel muy seca, especialmente en invierno",
                "Mi mente es muy activa, a veces inquieta, pero también muy imaginativa", "Mis movimientos son rápidos y enérgicos: tengo arranques de actividad",
                "Me exalto con facilidad", "Si de mí depende, mis hábitos de alimentación y descanso son irregulares",
                "Olvido con la misma rapidez con que aprendo"
            ],
            pitta: [
                "Me considero muy eficiente", "Soy sumamente preciso y ordenado en mis actividades",
                "Soy una persona decidida y de carácter fuerte", "El calor me provoca más incomodidad o fatiga que a la mayoría",
                "Tiendo a transpirar con facilidad", "Aunque no siempre lo demuestre, me irrito o me enfado con facilidad",
                "Saltarme una comida o no tomarla a su hora, me provoca malestar", "Mi cabello es prematuramente cano, lacio, rubio, rojizo o fino",
                "Tengo un buen apetito, si lo deseo puedo comer en gran cantidad", "Mucha gente me considera una persona obstinada",
                "El intestino me funciona con gran regularidad (más común diarrea que estreñimiento)", "Me impaciento con mucha facilidad",
                "Tiendo a ser perfeccionista respecto a los detalles", "Me enfado con bastante facilidad, pero el enfado se me pasa enseguida",
                "Me gustan mucho los alimentos fríos y las bebidas heladas", "Noto con mayor facilidad si hace mucho calor en una habitación",
                "No tolero los alimentos demasiado picantes o condimentados", "No soy muy tolerante con quienes disienten conmigo",
                "Me gustan los desafíos y cuando me fijo una meta no cedo hasta alcanzarla", "Tiendo a ser crítico con los demás y con mi persona"
            ],
            kapha: [
                "Mi tendencia natural es hacer mis tareas de manera lenta y relajada", "Aumento de peso con más facilidad que la mayoría y me cuesta más adelgazar",
                "Tengo un temperamento plácido y sereno, no me altero con facilidad", "Puedo saltarme comidas sin sufrir malestares significativos",
                "Tiendo a producir un exceso de mucosidad, flemas o congestión", "Necesito dormir como mínimo ocho horas para estar bien al día siguiente",
                "Tengo un sueño muy profundo", "Soy de naturaleza tranquila y no me enfado con facilidad",
                "No aprendo tan rápido, pero tengo excelente retentiva y memoria", "Tiendo a engordar y acumular grasa",
                "Me molesta el tiempo fresco y húmedo", "Tengo el cabello grueso, abundante, oscuro y ondulado",
                "Tengo la piel suave y la tez algo pálida", "Soy una persona corpulenta y de constitución sólida",
                "Soy una persona serena, dulce, afectuosa y perdono con facilidad", "Soy de digestión lenta, siento pesadez después de comer",
                "Tengo mucho aguante y resistencia física, y un nivel de energía estable", "Camino con paso lento y acompasado",
                "Tiendo a dormir demasiado y me cuesta ponerme en marcha por la mañana", "Como con lentitud, soy lento y metódico en mis actos"
            ]
        };

        // --- COMPONENTES ---

        const Header = () => (
            React.createElement("header", { className: "w-full bg-[#fff6ea] bg-opacity-95 shadow-sm py-4 px-6 flex justify-between items-center sticky top-0 z-50 backdrop-blur-sm" },
                React.createElement("div", { className: "flex items-center gap-3" },
                    React.createElement("img", { src: "isotiposamat.png", alt: "Sama Isotipo", className: "h-10 w-10 object-contain", onError: (e) => e.target.style.display = 'none' }),
                    React.createElement("div", null,
                        React.createElement("h1", { className: "text-xl font-bold text-[#fdd17c] leading-none" }, "sama"),
                        React.createElement("p", { className: "text-[10px] tracking-widest text-gray-500 uppercase" }, "Medicina de Equilibrio")
                    )
                ),
                React.createElement("div", { className: "hidden md:block text-sm text-[#fdd17c] font-semibold" }, "TEST DE BIOTIPO (PRAKRITI)")
            )
        );

        const ProgressBar = ({ current, total }) => {
            const progress = Math.min(100, (current / total) * 100);
            return React.createElement("div", { className: "w-full h-2 bg-gray-100 rounded-full overflow-hidden mb-6" },
                React.createElement("div", { className: "h-full bg-[#b1c52b] transition-all duration-500 ease-out", style: { width: `${progress}%` } })
            );
        };

        const QuestionCard = ({ text, value, onChange, index }) => (
            React.createElement("div", { className: "bg-white p-4 md:p-6 rounded-xl shadow-sm border border-gray-100 mb-4 hover:border-[#fdd17c] transition-colors" },
                React.createElement("div", { className: "flex flex-col md:flex-row gap-4 justify-between items-start md:items-center" },
                    React.createElement("p", { className: "text-gray-700 font-medium text-lg flex-1" },
                        React.createElement("span", { className: "text-[#b1c52b] font-bold mr-2" }, index + 1 + "."),
                        text
                    ),
                    React.createElement("div", { className: "w-full md:w-auto flex flex-col items-center gap-2" },
                        React.createElement("div", { className: "flex gap-1" },
                            [0, 1, 2, 3, 4, 5, 6].map((score) => (
                                React.createElement("button", {
                                    key: score,
                                    onClick: () => onChange(score),
                                    className: `w-8 h-8 md:w-10 md:h-10 rounded-full flex items-center justify-center text-sm font-bold transition-all ${value === score ? 'bg-[#b1c52b] text-white scale-110 shadow-md' : 'bg-gray-100 text-gray-400 hover:bg-[#fdd17c] hover:text-white'}`
                                }, score)
                            ))
                        ),
                        React.createElement("div", { className: "flex justify-between w-full text-[10px] text-gray-400 uppercase tracking-wider px-1" },
                            React.createElement("span", null, "No aplica"),
                            React.createElement("span", null, "Muy cierto")
                        )
                    )
                )
            )
        );

        // --- APP PRINCIPAL ---

        function App() {
            const [user, setUser] = useState(null);
            const [step, setStep] = useState('landing');
            const [scores, setScores] = useState({ vata: {}, pitta: {}, kapha: {} });
            const [email, setEmail] = useState('');
            const [isSubmitting, setIsSubmitting] = useState(false);
            const [results, setResults] = useState(null);

            useEffect(() => {
                if (isFirebaseReady && auth) {
                    signInAnonymously(auth).catch(console.error);
                    const unsubscribe = onAuthStateChanged(auth, setUser);
                    return () => unsubscribe();
                } else {
                    // Modo offline/demo user
                    setUser({ uid: 'demo-user' });
                }
            }, []);

            const handleScoreChange = (section, index, value) => {
                setScores(prev => ({ ...prev, [section]: { ...prev[section], [index]: value } }));
            };

            const calculateTotal = (section) => Object.values(scores[section]).reduce((a, b) => a + b, 0);
            const isSectionComplete = (section) => Object.keys(scores[section]).length === questionsData[section].length;

            const getDominantDosha = (totals) => {
                const { vata, pitta, kapha } = totals;
                const max = Math.max(vata, pitta, kapha);
                const dominants = [];
                if (vata === max) dominants.push('Vata');
                if (pitta === max) dominants.push('Pitta');
                if (kapha === max) dominants.push('Kapha');

                if (dominants.length === 3) return { type: 'Tridosha', desc: 'Equilibrio entre los tres', main: 'Vata-Pitta-Kapha' };
                if (dominants.length === 2) return { type: 'Bidosha', desc: `Predominio dual de ${dominants.join(' y ')}`, main: dominants.join('-') };
                return { type: 'Puro', desc: `Predominio claro de ${dominants[0]}`, main: dominants[0] };
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!email) return;
                setIsSubmitting(true);

                const totals = { vata: calculateTotal('vata'), pitta: calculateTotal('pitta'), kapha: calculateTotal('kapha') };
                const finalResult = getDominantDosha(totals);
                setResults({ totals, finalResult });

                if (isFirebaseReady) {
                    try {
                        await addDoc(collection(db, 'leads_dosha'), {
                            email: email, totals: totals, resultType: finalResult.main, detailScores: scores,
                            createdAt: serverTimestamp(), userId: user?.uid || 'anon'
                        });
                    } catch (error) {
                        console.error("Error guardando:", error);
                        alert("Error de conexión. Se mostrarán los resultados pero no se guardaron.");
                    }
                } else {
                    console.log("Modo Demo: Resultados no guardados en BD (Falta Config).", { email, totals });
                    await new Promise(resolve => setTimeout(resolve, 1500)); // Simular carga
                }
                
                setIsSubmitting(false);
                setStep('results');
            };

            // VISTAS
            const LandingView = () => (
                React.createElement("div", { className: "flex flex-col items-center justify-center min-h-[80vh] text-center px-4 max-w-2xl mx-auto animate-fade-in" },
                    React.createElement("div", { className: "mb-8 relative" },
                        React.createElement("div", { className: "absolute inset-0 bg-[#fdd17c] blur-3xl opacity-20 rounded-full" }),
                        React.createElement("img", { src: "isotiposamat.png", alt: "Sama", className: "w-32 h-32 relative z-10 animate-float", onError: (e) => { e.target.style.display='none'; document.getElementById('fallback-icon').style.display='flex'; } }),
                        React.createElement("div", { id: "fallback-icon", className: "w-32 h-32 rounded-full border-4 border-[#b1c52b] flex items-center justify-center relative z-0", style: { display: 'none' } },
                            React.createElement(Leaf, { className: "text-[#b1c52b] w-16 h-16" })
                        )
                    ),
                    React.createElement("h2", { className: "text-4xl font-bold text-gray-800 mb-4" }, "Descubre tu Biotipo ", React.createElement("span", { className: "text-[#b1c52b]" }, "Ayurveda")),
                    React.createElement("p", { className: "text-gray-600 text-lg mb-8 leading-relaxed" }, "El Ayurveda reconoce tres fuerzas primarias o Doshas (Vata, Pitta, Kapha). Responde este test honestamente para descubrir tu naturaleza."),
                    React.createElement("button", {
                        onClick: () => setStep('vata'),
                        className: "bg-[#b1c52b] text-white px-8 py-4 rounded-full text-xl font-bold shadow-lg hover:bg-[#9db025] hover:shadow-xl transition-all transform hover:-translate-y-1 flex items-center gap-2"
                    }, "Comenzar Test", React.createElement(ArrowRight, { className: "w-5 h-5" }))
                )
            );

            const SectionView = ({ dosha, title, icon: Icon, colorClass, nextStep }) => {
                const isComplete = isSectionComplete(dosha);
                return React.createElement("div", { className: "max-w-3xl mx-auto px-4 py-8 animate-fade-in" },
                    React.createElement("div", { className: "mb-8 flex items-center gap-4" },
                        React.createElement("div", { className: `p-3 rounded-full ${colorClass} bg-opacity-20` }, React.createElement(Icon, { className: `w-8 h-8 ${colorClass.replace('bg-', 'text-')}` })),
                        React.createElement("div", null, React.createElement("h2", { className: "text-2xl font-bold text-gray-800" }, `Sección ${title}`), React.createElement("p", { className: "text-sm text-gray-500" }, "Califica del 0 al 6"))
                    ),
                    React.createElement(ProgressBar, { current: Object.keys(scores[dosha]).length, total: 20 }),
                    React.createElement("div", { className: "space-y-4" },
                        questionsData[dosha].map((q, idx) => React.createElement(QuestionCard, { key: idx, index: idx, text: q, value: scores[dosha][idx], onChange: (val) => handleScoreChange(dosha, idx, val) }))
                    ),
                    React.createElement("div", { className: "mt-8 flex justify-end" },
                        React.createElement("button", {
                            onClick: () => { if (isComplete) { window.scrollTo(0,0); setStep(nextStep); } },
                            disabled: !isComplete,
                            className: `px-8 py-3 rounded-full font-bold text-lg flex items-center gap-2 transition-all ${isComplete ? 'bg-[#b1c52b] text-white shadow-lg hover:bg-[#9db025] cursor-pointer' : 'bg-gray-200 text-gray-400 cursor-not-allowed'}`
                        }, nextStep === 'email' ? 'Finalizar' : 'Siguiente', nextStep === 'email' ? React.createElement(CheckCircle2, { className: "w-5 h-5" }) : React.createElement(MoveRight, { className: "w-5 h-5" }))
                    )
                );
            };

            const EmailView = () => (
                React.createElement("div", { className: "max-w-md mx-auto px-4 py-12 text-center animate-fade-in" },
                    React.createElement("div", { className: "bg-white p-8 rounded-2xl shadow-xl border-t-8 border-[#fdd17c]" },
                        React.createElement("div", { className: "mb-6 bg-[#fdd17c] bg-opacity-20 w-16 h-16 rounded-full flex items-center justify-center mx-auto" }, React.createElement(Mail, { className: "w-8 h-8 text-[#d4a01c]" })),
                        React.createElement("h2", { className: "text-2xl font-bold text-gray-800 mb-2" }, "¡Tu resultado está listo!"),
                        React.createElement("p", { className: "text-gray-600 mb-6" }, "Ingresa tu correo para ver tu biotipo."),
                        React.createElement("form", { onSubmit: handleSubmit, className: "space-y-4" },
                            React.createElement("input", { type: "email", required: true, placeholder: "tu@email.com", value: email, onChange: (e) => setEmail(e.target.value), className: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#fdd17c] outline-none" }),
                            React.createElement("button", { type: "submit", disabled: isSubmitting, className: "w-full bg-[#b1c52b] text-white py-3 rounded-lg font-bold hover:bg-[#9db025] transition-colors flex justify-center items-center gap-2" }, isSubmitting ? "Procesando..." : "Ver Resultado")
                        ),
                        !isFirebaseReady && React.createElement("p", { className: "text-xs text-red-400 mt-4 bg-red-50 p-2 rounded" }, "⚠️ Modo Demo: Configura Firebase en index.html para guardar los leads.")
                    )
                )
            );

            const ResultView = () => {
                if (!results) return null;
                const { totals, finalResult } = results;
                const maxScore = Math.max(totals.vata, totals.pitta, totals.kapha, 1);
                
                const Bar = ({ label, score, color, bg }) => (
                     React.createElement("div", null,
                        React.createElement("div", { className: "flex justify-between mb-1" }, React.createElement("span", { className: `font-bold ${color}` }, label), React.createElement("span", { className: "text-gray-600 font-mono" }, `${score} pts`)),
                        React.createElement("div", { className: "w-full bg-gray-100 rounded-full h-4" }, React.createElement("div", { className: `${bg} h-4 rounded-full transition-all duration-1000`, style: { width: `${(score / maxScore) * 100}%` } }))
                     )
                );

                return React.createElement("div", { className: "max-w-4xl mx-auto px-4 py-8 animate-fade-in" },
                    React.createElement("div", { className: "bg-white rounded-2xl shadow-xl overflow-hidden mb-8" },
                        React.createElement("div", { className: "bg-[#b1c52b] p-8 text-white text-center" },
                            React.createElement("h2", { className: "text-lg font-medium opacity-90 mb-2" }, "Tu Biotipo es:"),
                            React.createElement("h1", { className: "text-5xl font-bold mb-4" }, finalResult.main),
                            React.createElement("p", { className: "text-xl opacity-90" }, finalResult.desc)
                        ),
                        React.createElement("div", { className: "p-8 space-y-6" },
                            React.createElement(Bar, { label: "Vata (Aire)", score: totals.vata, color: "text-blue-500", bg: "bg-blue-400" }),
                            React.createElement(Bar, { label: "Pitta (Fuego)", score: totals.pitta, color: "text-red-500", bg: "bg-red-400" }),
                            React.createElement(Bar, { label: "Kapha (Tierra)", score: totals.kapha, color: "text-green-600", bg: "bg-green-600" }),
                            React.createElement("div", { className: "mt-8 text-center" },
                                React.createElement("button", { onClick: () => window.location.reload(), className: "text-gray-400 underline hover:text-[#b1c52b] text-sm" }, "Realizar test nuevamente")
                            )
                        )
                    )
                );
            };

            return React.createElement("div", { className: "min-h-screen bg-[#fff6ea] font-sans" },
                React.createElement(Header),
                React.createElement("main", { className: "container mx-auto pb-20 pt-6" },
                    step === 'landing' && React.createElement(LandingView),
                    step === 'vata' && React.createElement(SectionView, { dosha: "vata", title: "Vata", icon: Wind, colorClass: "text-blue-400", nextStep: "pitta" }),
                    step === 'pitta' && React.createElement(SectionView, { dosha: "pitta", title: "Pitta", icon: Flame, colorClass: "text-red-400", nextStep: "kapha" }),
                    step === 'kapha' && React.createElement(SectionView, { dosha: "kapha", title: "Kapha", icon: Leaf, colorClass: "text-green-600", nextStep: "email" }),
                    step === 'email' && React.createElement(EmailView),
                    step === 'results' && React.createElement(ResultView)
                )
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
